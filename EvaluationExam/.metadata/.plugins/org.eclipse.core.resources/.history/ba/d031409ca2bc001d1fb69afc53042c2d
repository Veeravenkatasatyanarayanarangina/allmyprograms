package com.exam.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.reactive.function.client.WebClient;

import com.exam.model.Employee;
import com.exam.repository.EmployeeRepository;
import com.exam.serviceimpl.EmployeeService;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;



@RestController
public class HomeController {
	
	@GetMapping("/")
	public String text()
	{
		return "hai";
	}
	
	
	  @Autowired
	    private  EmployeeService employeeService;


	    @Autowired
	    private EmployeeRepository repository;

	    @PostMapping("/save")
	    public Employee saveEmployee(@RequestBody Employee employee )
	    {
	       return repository.save(employee);


	    }
	        @GetMapping("/search")
	        public List<Employee> searchEmployees(@RequestParam("name") String name) {
	            return this.employeeService.searchEmployees(name);
	        }
	    @GetMapping("/startwith")
	    public List<Employee> startWithEmployees(@RequestParam("name") String name) {
	        return repository.findByNameEndsWithIgnoreCaseNative(name);
	    }
	    @GetMapping("/endswith")
	    public List<Employee> endWithEmployees(@RequestParam("name") String name) {
	        return repository.findByNameEndsWithIgnoreCaseNative(name);
	    }

	        @GetMapping("/filter")
	        public List<Employee> filterEmployeesBySalaryRange(@RequestParam("minSalary") Double minSalary, @RequestParam("maxSalary") Double maxSalary) {
	            return this.employeeService.filterEmployeesBySalaryRange(minSalary, maxSalary);
	        }
	        
	        
	        @GetMapping("/get")
	    	public Object  getData(@RequestParam("id") String id) throws JsonProcessingException {
	    		String json = WebClient.create("https://jsonplaceholder.typicode.com/users").method(HttpMethod.GET).header(MediaType.APPLICATION_JSON_VALUE).retrieve().bodyToMono(String.class).block();
	    		Gson gson = new Gson();
	    		System.out.println(id);

	    		JsonObject jsonObject2 = null;

	    		JsonParser parser = new JsonParser();
	    		JsonArray jsonArray = parser.parse(json).getAsJsonArray();
	    		for(JsonElement obj : jsonArray){
	    			JsonObject id1 = obj.getAsJsonObject();
	    			String id2= id1.get("id").toString();
	    			if(id2.equalsIgnoreCase(id)){
	    				jsonObject2= id1;
	    			}
	    		}


	    		//System.out.println(jsonObject);

	    		/*JsonObject userObject = gson.fromJson(jsonObject, JsonObject.class);
	    		LinkedHashMap<Integer, JsonObject> userMap = new LinkedHashMap<>();
	    		userMap.put(userObject.get(""+id).getAsInt(), userObject);
	    		System.out.println(userMap.toString());*/
	    		return  jsonObject2.toString();
	    	}
}
